# Context Switch Monitor Skill

## 概述

这个 Skill 用于分析工作中的上下文切换模式，通过 Git 提交历史识别工作分散程度、测量切换成本，并提供专注度优化建议。

## 文件结构

```
context-switch-monitor/
├── SKILL.md          # Skill 定义文件
├── impl.py           # 实现脚本
├── test_skill.py     # 测试脚本
└── README.md         # 使用文档
```

## 功能特性

### 核心功能

1. **上下文切换检测**
   - 识别模块间的切换
   - 检测时间间隔导致的切换
   - 记录切换路径和频率

2. **工作区分散度评估**
   - 计算分散度指数 (0-100)
   - 提供专注度评级
   - 对比工作模式基准

3. **专注时段识别**
   - 发现深度工作时段
   - 分析工作持续时间
   - 识别主要工作模块

4. **优化建议生成**
   - 针对性改进建议
   - 通用专注技巧
   - 工作流优化方案

### 分析指标

| 指标 | 说明 | 评级标准 |
|------|------|----------|
| 分散度指数 | 工作分散程度 | 0-25 优秀, 26-50 良好, 51-75 需改进, 76-100 急需改进 |
| 切换频率 | 每日切换次数 | 越低越好 |
| 专注时段 | 持续工作块 | 数量多、时长长为佳 |
| 模块分布 | 工作涉及模块 | 过多表示工作分散 |

## 如何使用

### 方式 1: 直接运行脚本

```bash
python3 skillsets/context-switch-monitor/impl.py
```

### 方式 2: 运行测试脚本

```bash
python3 skillsets/context-switch-monitor/test_skill.py
```

### 方式 3: 通过 Skill 触发

在对话中使用以下短语：

- "分析工作被打断情况"
- "上下文切换分析"
- "专注度评估"
- "我的工作模式分析"
- "检查工作效率"

## 输出文件

执行后会生成 `context_switch_report.txt`，包含：

### 报告结构

```
==============================================================================
上下文切换分析报告
==============================================================================

📊 基本统计
  - 提交数量
  - 时间跨度
  - 平均每日提交

🔄 上下文切换分析
  - 总切换次数
  - 平均每日切换
  - 切换类型分布

📁 工作模块分布
  - 涉及模块数
  - 模块活跃度排名

🔀 主要模块切换路径
  - 最常见的切换模式

🎯 专注时段识别
  - 深度工作时段列表
  - 时长和模块分析

📈 工作区分散度评估
  - 分散度指数
  - 专注度评级
  - 评估说明

⏱️ 切换成本估算
  - 恢复时间损失
  - 效率影响分析

💡 专注优化建议
  - 针对性建议
  - 通用优化技巧

📋 最近上下文切换记录
  - 详细切换历史
```

## 使用场景

### 场景 1: 评估工作效率

```
用户: "我的工作效率怎么样？"
系统: 运行分析，查看分散度指数和专注时段数量
```

### 场景 2: 识别被打断情况

```
用户: "分析我的工作被打断情况"
系统: 分析上下文切换频率和模式
```

### 场景 3: 改善工作习惯

```
用户: "如何提高专注度？"
系统: 基于历史数据提供个性化建议
```

## 分析原理

### 上下文切换定义

一次上下文切换满足以下任一条件：

1. **模块切换**: 连续提交修改不同模块的文件
2. **时间间隔**: 提交间隔超过 30 分钟（默认阈值）

### 分散度计算

```
分散度指数 = (切换频率权重 × 70%) + (模块多样性权重 × 30%)

其中:
- 切换频率 = 切换次数 / 总提交数 × 100
- 模块多样性 = 涉及模块数 × 5
```

### 专注时段识别

满足以下条件的连续提交序列：

- 持续时间 ≥ 45 分钟
- 切换次数 ≤ 2 次
- 至少 3 次提交

## 技术实现

### 依赖工具

- **Git**: 版本控制系统
- **Python 3.x**: 运行环境

### 数据来源

- `git log`: 获取提交历史
- `git diff`: 分析文件变更
- 提交时间戳: 计算时间间隔

### 核心算法

1. **模块提取**: 从文件路径提取逻辑模块
2. **切换检测**: 对比连续提交的模块和时间
3. **时段聚合**: 识别连续专注时段
4. **指数计算**: 综合评估分散程度

## 测试状态

✅ 所有测试通过

测试覆盖：
- 文件结构验证
- 脚本执行测试
- 中文输出验证
- 错误处理检查
- 功能完整性测试

## 优化建议分类

### 针对性建议

基于具体分析结果：

- 高分散度 → 批量处理相似任务
- 低专注时段 → 安排深度工作时间
- 高模块切换 → 使用原子提交

### 通用技巧

适用所有场景：

- 番茄工作法 (25+5)
- 独立分支隔离任务
- 定期回顾改善情况
- 高低精力时段分配

## 注意事项

### 最佳实践

1. **数据积累**: 建议至少 1-2 周的提交数据
2. **定期分析**: 每周或每月运行一次
3. **趋势跟踪**: 比较不同时期的变化
4. **结合实际**: 考虑项目阶段和任务类型

### 限制说明

- 仅分析 Git 记录的工作活动
- 不反映非编码工作的时间分配
- 切换阈值为默认值，可能需要调整
- 分散度指数为相对值，非绝对标准

## 扩展配置

### 自定义时间范围

编辑 `impl.py` 中的 `days` 参数：

```python
# main() 函数中
days = 30  # 改为其他天数
```

### 调整切换阈值

修改 `detect_context_switches()` 调用：

```python
switches = detect_context_switches(
    commits,
    time_threshold_minutes=30  # 调整分钟数
)
```

### 修改专注时段标准

更改 `identify_focus_periods()` 调用：

```python
focus_periods = identify_focus_periods(
    commits,
    switches,
    min_duration_minutes=45  # 调整最小时长
)
```

## 下一步

1. 运行分析获取当前状态
2. 查看报告了解工作模式
3. 根据建议调整工作习惯
4. 定期重新分析跟踪改进
5. 对比历史数据评估效果

## 常见问题

### Q: 为什么没有检测到提交？

A: 确保在 Git 仓库目录下运行，且有足够的提交历史。

### Q: 分散度指数很高怎么办？

A: 参考"优化建议"部分，逐步实施批量工作、时间块管理等策略。

### Q: 分析结果与实际感受不符？

A: 可能是非编码工作未记录，或需要调整切换阈值参数。

### Q: 如何改进专注度？

A: 从最简单的建议开始，如番茄工作法，逐步建立深度工作习惯。
