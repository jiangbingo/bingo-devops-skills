# Test Coverage Analyzer

测试覆盖率分析工具，支持多种编程语言的测试覆盖率分析。

## 功能特性

- 🔍 **自动检测**: 自动检测项目中的覆盖率工具和数据文件
- 📊 **多语言支持**: 支持 Python (coverage.py) 和 JavaScript/TypeScript (jest/vitest)
- 📈 **可视化报告**: 生成带有可视化进度条的覆盖率报告
- 🎯 **优先级建议**: 根据文件大小和覆盖率提供测试优先级建议
- ⚠️ **风险识别**: 识别零覆盖率和低覆盖率文件

## 使用场景

### 查看测试覆盖率
```
"测试覆盖率如何"
"What's the test coverage?"
"分析测试覆盖"
```

### 查找未测试代码
```
"哪些代码缺少测试"
"Show me untested code"
"检查测试覆盖缺口"
```

### 生成覆盖率报告
```
"生成测试覆盖率报告"
"Generate coverage report"
```

## 使用方法

### 1. 准备覆盖率数据

#### Python 项目

```bash
# 安装 coverage.py
pip install coverage

# 运行测试并收集覆盖率
coverage run -m pytest

# 生成 JSON 报告
coverage json
```

#### JavaScript/TypeScript 项目 (jest)

```bash
npm test -- --coverage --coverageReporters=json
```

#### JavaScript/TypeScript 项目 (vitest)

```bash
npx vitest run --coverage
```

### 2. 运行分析

```bash
python3 skillsets/test-coverage-analyzer/impl.py
```

### 3. 查看报告

生成的报告将保存为 `test_coverage_report.txt`

## 输出报告说明

报告包含以下部分：

### 📈 总体统计
- 总体覆盖率（带可视化条）
- 分支覆盖率（如果有）
- 总代码行数和已覆盖行数

### 📊 覆盖率分布
- Excellent (90-100%): 🟢 测试充分
- Good (75-89%): 🟢 覆盖良好
- Fair (50-74%): 🟡 需要改进
- Poor (25-49%): 🟠 覆盖不足
- Critical (0-24%): 🔴 急需测试

### 🔴 零覆盖率文件
列出所有完全没有测试覆盖的文件

### 🟠 低覆盖率文件
列出覆盖率低于 50% 的文件

### 📁 文件覆盖率详情
每个文件的详细覆盖率，按覆盖率从高到低排序

### 💡 改进建议
- 紧急、重要、建议级别的文件数量
- 测试优先级建议（按文件大小排序）

## 覆盖率等级说明

| 等级 | 覆盖率范围 | 含义 | 建议 |
|------|-----------|------|------|
| Excellent | 90-100% | 测试充分 | 保持当前水平 |
| Good | 75-89% | 覆盖良好 | 针对边缘情况补充测试 |
| Fair | 50-74% | 需要改进 | 增加主要路径的测试 |
| Poor | 25-49% | 覆盖不足 | 需要系统性地增加测试 |
| Critical | 0-24% | 急需测试 | 优先添加基础测试 |

## 常见问题

**Q: 支持哪些编程语言？**
A: 目前支持 Python (coverage.py) 和 JavaScript/TypeScript (jest/vitest)。计划支持更多语言。

**Q: 为什么显示"未找到覆盖率数据"？**
A: 请先运行测试并生成覆盖率报告。参考上面的"准备覆盖率数据"部分。

**Q: 100% 覆盖率一定是好事吗？**
A: 不一定。高质量的测试比单纯的覆盖率更重要。关注关键业务逻辑的测试质量。

**Q: 如何提高覆盖率？**
A: 1. 从低覆盖率文件开始 2. 优先测试复杂功能 3. 添加边界条件测试 4. 测试错误处理路径

**Q: 覆盖率多少算合适？**
A: 这因项目而异。一般建议：
- 关键业务逻辑：90%+
- 核心功能：75%+
- 工具/辅助代码：50%+

## 技术细节

### 支持的覆盖率工具

| 语言 | 工具 | 配置文件 | 输出文件 |
|------|------|----------|----------|
| Python | coverage.py | .coveragerc | coverage.json |
| JavaScript/TypeScript | jest | jest.config.js | coverage/coverage-final.json |
| JavaScript/TypeScript | vitest | vitest.config.ts | coverage/coverage-final.json |

### 排除文件

在覆盖率工具配置中可以排除不需要测试的文件：

#### Python (.coveragerc)
```ini
[run]
omit =
    */tests/*
    */test_*
    */__pycache__/*
    */venv/*
    */node_modules/*
```

#### Jest (jest.config.js)
```javascript
module.exports = {
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/**/*.d.ts',
    '!src/**/*.test.{js,jsx,ts,tsx}',
  ],
};
```

## 示例输出

```
================================================================================
📊 测试覆盖率分析报告 (Test Coverage Analysis)
⏰ 分析时间: 2025-01-30 14:30:00
================================================================================

📈 总体统计
--------------------------------------------------------------------------------
总体覆盖率: [████████████░░░░░░░░] 60.5% Fair 🟡
分支覆盖率: [█████████░░░░░░░░░░░] 50.2% Fair
总代码行数: 10,234
已覆盖行数: 6,195
未覆盖行数: 4,039

📊 覆盖率分布
--------------------------------------------------------------------------------
🟢 Excellent: 15 个文件
🟢 Good: 23 个文件
🟡 Fair: 18 个文件
🟠 Poor: 8 个文件
🔴 Critical: 3 个文件

🔴 零覆盖率文件
--------------------------------------------------------------------------------
  • src/utils/deprecated.js
  • src/legacy/api.js
  • src/old/parser.py

🟠 低覆盖率文件 (< 50%)
--------------------------------------------------------------------------------
  [██████░░░░░░░░░░] 35.2% src/services/auth.js
  [████░░░░░░░░░░░░] 25.0% src/utils/validator.js
  ...
```

## 最佳实践

1. **定期检查**: 在 CI/CD 流程中集成覆盖率检查
2. **设置阈值**: 为项目设置最低覆盖率要求
3. **关注趋势**: 关注覆盖率的变化趋势，而不只是绝对值
4. **质量优先**: 高质量的测试比盲目追求 100% 覆盖率更重要
5. **渐进式改进**: 从关键路径开始，逐步提高覆盖率

## 下一步

1. 查看生成的 `test_coverage_report.txt` 获取详细分析
2. 根据优先级建议为低覆盖率文件添加测试
3. 定期运行分析以跟踪覆盖率变化
4. 将覆盖率检查集成到 CI/CD 流程

## License

MIT
