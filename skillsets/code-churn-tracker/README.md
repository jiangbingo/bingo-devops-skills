# Code Churn Tracker

追踪代码变更率，识别频繁修改的文件，帮助发现潜在的技术债务和设计问题。

## 功能特性

- 🔍 **变更追踪**: 分析 Git 历史，统计每个文件的修改次数
- 📊 **稳定性评分**: 基于修改频率计算代码稳定性指标
- 🎯 **风险识别**: 发现高变动、低稳定性的风险区域
- 📈 **趋势分析**: 按文件类型分析变更模式
- 💡 **改进建议**: 提供针对性的代码改进建议

## 使用场景

### 识别高变动文件
```
"哪些文件变动最频繁？"
"Show me high-churn files"
```

### 分析代码稳定性
```
"分析代码稳定性"
"检查哪些文件不稳定"
```

### 追踪变更历史
```
"追踪最近一个月的代码变更"
"哪些文件最近改动比较多？"
```

## 使用方法

### 1. 直接运行

```bash
python3 skillsets/code-churn-tracker/impl.py
```

### 2. 运行测试

```bash
python3 skillsets/code-churn-tracker/test_skill.py
```

### 3. 查看

生成的报告将保存为 `code_churn_report.txt`

## 输出报告说明

报告包含以下部分：

### 📊 变更统计摘要
- 总提交数
- 涉及文件数
- 新增/修改/删除操作统计

### 🟢🟡🔴 稳定性分布
- **高稳定性 (80-100)**: 很少修改的稳定代码
- **中稳定性 (50-79)**: 适度修改，可接受范围
- **低稳定性 (0-49)**: 频繁修改，可能存在问题

### 🔥 高变动文件
列出修改次数最多的 Top 20 文件，包含：
- 提交次数
- 稳定性评分
- 文件大小
- 修改者数量

### ⚠️ 风险区域识别
识别需要关注的高风险文件：
- 低稳定性 + 高变动率
- 大文件 + 高变动次数

### 📁 按文件类型分析
按文件扩展名统计变更情况，帮助识别哪种类型的代码最不稳定

### 💡 改进建议
针对发现的问题提供具体的改进建议

## 分析指标说明

### 稳定性评分计算

稳定性评分综合考虑以下因素：
- **提交频率**: 修改次数越少，稳定性越高
- **变动率**: 每天修改次数越少，稳定性越高
- **文件大小**: 大文件更容易不稳定

评分范围：0-100
- 80-100: 非常稳定
- 50-79: 中等稳定
- 0-49: 不稳定

### 风险识别标准

文件被标记为高风险需满足以下条件之一：
1. 稳定性 < 50 且变动率 > 0.1 次/天
2. 文件大小 > 50KB 且修改次数 > 10 次

## 技术细节

### 依赖工具
- **Git**: 用于获取提交历史
- **Python 3.6+**: 运行分析脚本

### 排除的文件模式
以下文件/目录自动排除：
- `node_modules/`, `vendor/` - 依赖包
- `.git/`, `dist/`, `build/` - 构建产物
- `__pycache__/`, `*.pyc` - Python 缓存
- `*.min.js`, `*.min.css` - 压缩文件
- `package-lock.json`, `yarn.lock` - 锁文件
- `Pods/`, `.xcodeproj/` - iOS 相关
- `DerivedData/` - Xcode 构建

### 分析时间范围
默认分析最近 90 天的提交记录。可在代码中调整 `days` 参数。

## 使用建议

1. **定期分析**: 建议每周或每月运行一次，跟踪代码健康度变化
2. **代码审查**: 在 PR 审查时关注高变动文件的修改
3. **重构优先级**: 将高变动、低稳定性的文件作为重构候选
4. **团队讨论**: 与团队讨论频繁修改的根本原因
5. **架构评估**: 对持续高变动的区域进行架构审查

## 示例输出

```
================================================================================
代码变更率分析报告 (Code Churn Analysis)
分析时间: 2025-01-30 10:30:00
分析周期: 2024-10-31 至今 (90 天)
================================================================================
总提交数: 156
涉及文件数: 89

================================================================================
📊 变更统计摘要
================================================================================
新增文件: 12
修改操作: 342
删除文件: 5

稳定性分布:
  🟢 高稳定性 (80-100): 45 个文件
  🟡 中稳定性 (50-79):  28 个文件
  🔴 低稳定性 (0-49):   16 个文件

================================================================================
🔥 高变动文件 (Top 20)
================================================================================
文件路径                                              提交数   稳定性     大小          修改者数
------------------------------------------------------------------------------
src/utils/validation.js                            45      🟡 52      15.2 KB      3
src/components/UserForm.tsx                        38      🔴 42      8.7 KB       5
...
```

## 常见问题

**Q: 为什么有些文件没有显示？**
A: 文件可能被排除模式过滤掉了，或者在分析周期内没有修改记录。

**Q: 如何调整分析时间范围？**
A: 修改 `impl.py` 中 `main()` 函数的 `days` 参数。

**Q: 稳定性评分低一定不好吗？**
A: 不一定。某些文件（如配置、业务规则）可能需要频繁修改。关键是理解修改原因。

**Q: 如何添加自定义排除模式？**
A: 在 `impl.py` 的 `EXCLUDE_PATTERNS` 列表中添加正则表达式。

## License

MIT
