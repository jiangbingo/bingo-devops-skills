# Branch Hygiene Checker Skill

## 概述

这个 Skill 用于检查 Git 仓库的分支健康度，帮助识别和清理僵尸分支、已合并分支以及命名规范问题。

## 文件结构

```
branch-hygiene-checker/
├── SKILL.md          # Skill 定义文件
├── impl.py           # 实现脚本
├── test_skill.py     # 测试脚本
└── README.md         # 使用文档
```

## 功能特性

### 1. 僵尸分支检测
- 识别 90 天内无活动的分支
- 显示最后提交日期和提交数量
- 标记可能需要清理的分支

### 2. 已合并分支识别
- 检测已合并到主分支的分支
- 提供安全的删除建议
- 生成清理命令

### 3. 命名规范检查
- 支持标准命名规范：feature/、bugfix/、hotfix/、release/
- 识别不符合规范的分支
- 提供命名规范统计

### 4. 分支依赖分析
- 分析分支基于哪个主分支
- 显示分支提交数量
- 跟踪分支活动状态

### 5. 清理建议
- **高优先级**：已合并且无活动的分支
- **中优先级**：已合并的分支
- **低优先级**：僵尸分支但未合并
- 提供一键清理命令

## 如何使用

### 方式 1: 直接运行脚本

```bash
cd /path/to/your/git/repository
python3 /path/to/branch-hygiene-checker/impl.py
```

### 方式 2: 运行测试脚本

```bash
python3 /path/to/branch-hygiene-checker/test_skill.py
```

### 方式 3: 通过 Skill 触发

在对话中使用以下短语：
- "检查分支状态"
- "清理旧分支"
- "有哪些僵尸分支"
- "分支命名规范检查"

## 输出文件

执行后会生成 `branch_hygiene_report.txt` 文件，包含：

1. **摘要统计**
   - 总分支数
   - 主分支名称
   - 各类分支数量

2. **僵尸分支列表**
   - 分支名称
   - 最后提交日期
   - 提交数量
   - 命名规范状态

3. **已合并分支列表**
   - 可安全删除的分支
   - 详细信息

4. **命名规范分析**
   - 规范分布统计
   - 不符合规范的分支

5. **活跃分支列表**
   - 90 天内有活动的分支

6. **清理建议**
   - 优先级分类
   - 清理命令

## 命名规范

支持以下命名规范：

| 前缀 | 用途 | 示例 |
|------|------|------|
| `feature/` | 新功能分支 | `feature/user-auth` |
| `bugfix/` | Bug 修复分支 | `bugfix/login-error` |
| `hotfix/` | 紧急修复分支 | `hotfix/security-patch` |
| `release/` | 发布准备分支 | `release/v1.0.0` |
| `develop` | 开发环境分支 | `develop` |
| `main/master` | 主分支 | `main` |

## 分析标准

### 僵尸分支定义
- 最后一次提交距今超过 90 天
- 无任何活动迹象
- 可能已被遗忘或废弃

### 已合并分支定义
- 所有提交已合并到主分支
- 无未合并的更改
- 可安全删除

### 清理优先级

#### 🔴 高优先级
- 已合并到主分支
- 90 天无活动
- **建议立即删除**

#### 🟡 中优先级
- 已合并到主分支
- 近期有活动
- **可考虑删除**

#### 🟢 低优先级
- 未合并到主分支
- 90 天无活动
- **需确认后删除**

## 测试状态

✅ 所有测试通过

测试覆盖：
- 文件完整性检查
- Git 环境检测
- Python 语法验证
- 脚本执行测试
- 输出文件验证

## 依赖

- Git 命令行工具
- Python 3.x
- 标准 Python 库（subprocess, datetime, collections）

## 使用示例

### 示例 1: 检查分支状态

```bash
$ python3 impl.py
🔍 正在检查分支健康度...
📋 正在获取所有分支...
✅ 找到 15 个分支
🔬 正在分析分支数据...
✅ 分析完成
📝 正在生成分析报告...
✅ 报告已保存到: branch_hygiene_report.txt

📋 分析摘要
  总分支数: 15
  主分支: main
  僵尸分支: 3 个
  已合并分支: 5 个
  活跃分支: 7 个
  命名规范问题: 2 个
  报告文件: branch_hygiene_report.txt
```

### 示例 2: 清理旧分支

根据报告中的建议，执行清理命令：

```bash
# 高优先级清理（已合并且无活动）
git branch -D feature/old-feature bugfix/issue-123

# 中优先级清理（已合并）
git branch -d release/v1.0.0 feature/completed-task
```

## 常见问题

### Q: 为什么要清理僵尸分支？
A: 僵尸分支会：
- 增加仓库复杂度
- 造成混淆
- 占用存储空间
- 影响分支列表的可读性

### Q: 如何避免僵尸分支？
A:
- 遵循分支命名规范
- 及时删除已合并的分支
- 定期运行健康检查
- 建立分支生命周期管理流程

### Q: 删除分支会丢失代码吗？
A:
- 已合并的分支：代码已在主分支中，安全删除
- 未合并的分支：删除会丢失代码，需谨慎
- 建议删除前先检查是否有未合并的更改

## 最佳实践

1. **定期检查**：每月运行一次分支健康检查
2. **及时清理**：合并后立即删除分支
3. **命名规范**：始终使用标准命名规范
4. **主分支保护**：保护 main/master 分支
5. **自动化**：集成到 CI/CD 流程中

## 下一步

1. 在你的 Git 仓库中运行此脚本
2. 查看 `branch_hygiene_report.txt` 获取详细分析
3. 根据报告中的建议进行分支清理
4. 定期重新运行此分析以跟踪分支状态
5. 建立分支管理最佳实践

## 技术细节

### 实现原理

1. **获取分支列表**
   ```bash
   git branch -a
   ```

2. **检查最后提交日期**
   ```bash
   git log -1 --format=%ci <branch>
   ```

3. **检查是否已合并**
   ```bash
   git branch --merged <main-branch>
   ```

4. **获取提交数量**
   ```bash
   git rev-list --count <branch>
   ```

### 性能考虑

- 脚本执行时间取决于分支数量
- 通常在 1-5 秒内完成
- 使用缓存可提高性能（未实现）

## 贡献

欢迎提交问题和改进建议！
